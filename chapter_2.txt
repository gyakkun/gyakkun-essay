第二章 架设PT网站所需要的技术综述


2.1 Bittorrent协议, Bencode编码与Torrent文件

Bittorrent(简称BT)协议是用在对等网络中目标为用户群对用户群(Peer-to-peer)的文件分享网络协议, 最大的特点为下载同一文件的用户越多, 下载该文件就越迅速。下载如果不关闭相应的BT客户端软件的话, 继续维持上传状态, 就可以该形式"分享"所下载的文件, 在这种场景下, 每一个BT客户端都起到类似CDN的作用。

BT协议将所需要分享的单个文件或者一组文件按照用户指定的顺序平铺成连续的总和二进制数据段, 然后按照用户指定的分块大小(Trunk size)进行补齐与分块, 使用SHA-1算法逐分块地对二进制数据段进行哈希, 生成相应分块的哈希值, 各分块的哈希值简单按先后顺序前后拼接在一起, 成为总和二进制数据段的哈希值, 这个总和哈希值在之后的使用中起到校验所下载的文件的作用。

由于上述平铺总和式的校验方式, 必须要对之后所下载的数据按照原始文件长度进行切割方可得到原始语义上的文件。同时, 为了方便地将这些分块校验码信息、文件长度信息在互联网上传播, 需要一种文件格式将上述信息进行编码。BT协议的提出者Bram Cohen创造性地提出了Bencode编码规则, 并在之后的Torrent文件(以下称作种子文件)生成步骤中进行了相应的实现。

Bencode编码的种子文件使用ASCII字符进行编码, 使得即使在普通文本编辑器中打开也能读懂其中的语义。Bencode中定义了字符串(Byte strings)、整数(Integers)、线性表(Lists)以及字典(Dictionary, 即关联数组(associative arrays))四种基本数据类型, 其中的串列类似于数组, 字典类似于键值对, 通过他们的组合就可以得到足够复杂的层级结构。

Bencode编码将要编码的内容通过简单的字母对括起来, 或者是指定长度后用冒号表示出来。如整数用i和e括起来, `i233e`表示正整数233, `i-233e`表示负整数-233。字符串则是"长度:内容", 如`12:xiaowufeixia`表示"xiaowufeixia"这个字符串。线性表允许不同的数据类型混杂, 使用l和e括起来, 比如对前述的两种数据结构, `l12:xiaowufeixiai233ee`表示依次的字符串"xiaowufeixia"以及正整数233。字典表用d和e括住所要编码的内容, 字典元素中键和值必须紧跟在一起, 所有键只能为字符串类型, 且键的字符串按照字典序排列。如键为"xiaowufeixia"值为正整数233, 紧接键为"gyakkun"值为负整数-233的字典表将被编码为`d7:gyakkuni-233e12:xiaowufeixiai233ee`。

那么Torrent种子文件的结构也就呼之欲出了。根是一个字典, 下有一个键为"info"的字典节点, info字典的第一个键值对键为"files", 值为线性表, 线性表中的各个节点又以字典和线性表的形式存放着所分享的不同文件的具体长度。info字典的第二个键值对键为"name"值为所分享的文件文件名, 或是文件夹名。info字典的第三个键值对键为"piece length", 表示用户指定的分块大小长度, 值是正整数, 通常是2的幂次。紧跟着的info字典的第四个键值对键是"pieces", 值就是前述的总和哈希值, 以字符串的形式存储。

[图 配上Bencode Editor的图]

2.2 适用于BT协议的Tracker服务器及Private Tracker



2.3 BT客户端软件


2.4 Laravel MVC框架


2.5 UNIT3D-Community-Edition







