第一章 概述


1.1 背景及动机

随着新校长的上任, 新校区、新院系的建设如火如荼地进行着, 然而随之而来的是过渡时期旧校区不得不接纳更多待迁移至新校区的新生, 以及宿舍的四人间改六人间、食堂容量的扩增、深圳校区临时教学办公场所建设等的问题。其中很少被人提及, 但却又实实在在地影响着每位学生每天学习、生活体验的就是校园网的网速问题。显然, 在人数增加的情况下, 校园网, 尤其是人数急剧增加的东校区的出口带宽并没有随着之增加, 在网络中心的限速策略下, 校区内人均带宽发生了一定的下降, 在晚上(18:00~24:00)这段网络高峰时间的网络拥堵情况尤为显著, 表现为看网课、游戏主播等直播类应用的卡顿、在线视频应用无法调整为高清分辨率, 自动回落到低分辨率, 游戏因为网络拥塞导致的高延迟等, 都极为影响使用体验[注]。

此外, 笔者还向学校网络中心确认了因为出口带宽吃紧导致的校园网IPv6开始正式实施限速措施, 即限速至人均10Mbps[注], 和之前不限速比起来, 使用体验有着天壤之别。

在此之前, 校内, 尤其是以数据科学与计算机学院院内的一群学生为首的IPv6协议爱好者, 一直致力于在校园内推广IPv6协议应用的使用, 包括但不限于视频直播、文件资源分享、开发镜像CDN等应用类型, 涵盖面广泛, 覆盖了院内学生的诸多需求与现实关切。笔者作为爱好者之一, 深感在学生群体中推广基于IPv6协议应用的必要性, 在养成良好的校内乃至对公网的IPv6协议应用的使用习惯后, 能够使得本来蜂拥至校园网出口的流量变成校园内局域网的流量, 继而大大减轻校园网公网出口的负担, 从而能提供良好的校园网使用体验。

基于上述现实, 笔者及同好们提出了建设一个基于IPv6的资源分享平台的构想, 初步规划使用成熟的Bittorrent协议及相应的客户端软件, 开发一个服务器端的资源分享发布平台, 相比传统的FTP/HTTP等单点C/S、B/S的文件发布分享方式, 具有极好的容错性, 同时Bittorrent协议的分布式特点也能较好地分担各个客户端节点的负担, 使得每位用户都能在较小的性能损耗下收获较好的使用体验。

下面将简要描述国内以IPv6协议推广为目的的大学校内Bittorrent协议资源分享平台现状。

Bittorrent(以下简称BT)作为一种曾经极为流行的文件传输协议, 即使在现在依然有着广泛的用户基础。虽然如今文件分享的主流方式是以百度网盘为首的在线文件存储应用及相关云服务, 但笔者一直相信, 不依赖单一节点的分布式的文件分享才是文件分享的终极方式。国内不少大学的有识之士也认识到这一点, 为此开发、部署、运营着大量的BT资源分享平台。

由于互联网的开放性, 一国国内合法获取的资源在另一国未必具有相应的国内版权, 因此不少BT网站为了规避风险, 将BT分享平台唯一需要中心化部署的追踪器服务器(Tracker)采取账号化管理, 需要注册登录取得相应的鉴权(authentication)方能正常使用 (详细的描述见第二章)。国内大学的BT平台为了规避版权等风险, 不约而同地采取了这样的管理方式。这种管理方式被称作私有追踪器(Private Tracker, 以下简称PT)。PT网站因为需要用户注册登录系统, 以及Torrent文件(种子文件, 下记种子)的发布、管理平台, 是需要进行一定的系统分析、调研后去建构及耗时开发的。国内大学的一些团队做了相应的工作, 并将其开源, 运用在了不少其他大学的PT网站上。

提到国内大学PT网站所用到的系统, 永远无法绕过的是浙江大学NexusPHP团队开发的NexusPHP[注: https://github.com/ZJUT/NexusPHP]系统。以它为基础, 部署、运营、二次开发的代表性PT网站有北京邮电大学的北邮人BYRBT[注], 天津大学的北洋园TJUPT[注]等。除了NexusPHP外,  还有以国内最早的教育网PT, 东北大学六维空间[注]为代表的使用开源论坛系统Discuz![注: https://www.discuz.net/]为基础二次开发的PT系统。

目前, 北京邮电大学的北邮人BYRPT和东北大学的六维空间是国内目前最大的教育网内的PT网站。


1.2 PT网站选型、开发的问题描述

为了能够尽快、可靠地实现前述构想, 笔者及同好必须要在既有的系统中进行选型, 进而二次开发, 尽快上线部署, 赶在新生入学等关键的时间节点进行推广, 进而达到校园网资源最大化利用的目标。开发选型的两个首要选项是1.2中提到的NexusPHP和Discuz!, 两者都是目前比较成熟的PT网站使用的系统, 且都用PHP语言写就。

其中NexusPHP基于TBSource[注: https://sourceforge.net/projects/tbsource/]开发, 在后者的基础上添加或完善了大量功能，同时极大地提高了代码效率(除TBSource外，还吸取了一些其它private tracker的想法或代码，如Bit-HDTV，What.cd和SceneTorrents)[注, 直接抄自NeuxsPHP简介]。NexusPHP最后一个公开版本发布于2012年7月7日, 版本号为Standard v1.5 Beta 5[注: https://sourceforge.net/projects/nexusphp/files/], 包括北邮人BYRBT在内的国内不少NexusPHP PT网站都是基于这个版本二次开发的。

另一方面, 以六维空间为代表的一类PT网站使用成熟的开源论坛系统Discuz!为基础, 利用既有的用户管理功能和附件功能, 在这之上加入流量统计等功能, 使之成为符合PT要求的网站。

然而上述的两个系统都有自己的问题。首先是早期NexusPHP开发的时候, PHP语言的开发范式尚未形成, 许多现代语言的特性, 如包管理、前端解耦、自动构建等系统都没有成熟可靠的方案, 成熟的MVC(Model, View, Controller)框架也未问世, 导致NexusPHP几乎就是在TBSource的基础上继续"裸"写网页。读者不妨想象一下从一无所有的"hello world"程序开始写起到写成DOS系统的过程, 虽然有一定的夸张成分, 但要用早期的PHP标准编写这样网页应用绝非易事, 而在这基础上的二次开发更是难上加难。事实上, 在同好间早期的网站内部试运营中, 笔者尝试使用了以NexusPHP为基础二次开发的天津大学北洋园TJUPT的开源版本, 其在原始的NexusPHP的基础上美化了样式, 使之更符合现在的审美。然而, 要想在该系统之上进行功能的增删或者调整, 由于代码文件组织结构的不清晰, 以及缺少原始的开发文档等, 诸多变量及方法名都不明晰, 开发难度极大, 因此在之后的选型中被弃用。

而另一个基于Discuz!的PT系统目前鲜有开源版本面世, 介于其本来是为"互联网论坛"这一需求开发的, 不少功能上的冗余需要耗费时间去剔除, 为此期间需要阅读开发文档所带来的时间开销将是相当无用的消耗, 与快速上线的需求不相符。同时, 论坛系统以交流为导向的开发方向与资源分享交流的总目标不甚一致。因此基于上述理由, 笔者未使用Discuz!及其衍生系统进行二次开发。

在既有的开源项目中, 国人作者taobataoma开发的meanTorrent[注: https://github.com/taobataoma/meanTorrent]是使用Javascript编写, 以mean(MongoDB[注] 文档式数据库, Express[注] MVC框架, Angular.js[注] 前端框架, Node.js[注] 后端运行时(Runtime))这一相对较多人使用的开发框架组合进行开发。笔者也曾经为其贡献过代码[注], 然而时过境迁, 现在其开发已经陷入沉寂。而且以Node.js开发的网页应用后端系统不可避免地会遇到Javascript这一纯脚本型语言带来的性能问题。

选型过程中相中的另一个开源项目是目前正在活跃开发的UNIT3D-Community-Edition[注: https://github.com/HDInnovations/UNIT3D-Community-Edition], 由美国开发者HDVinnie发起。该项目使用PHP编写, 以成熟的Laravel框架为基础开发, 前端框架可以使用时下正红的React[注]或者Vue[注], 具有良好的用户界面(User Interface, 以下简称UI), 并且前后端解耦, 代码组织结构清晰, 变量方法名命名规范, 能够自我解释, 进行二次开发的难度最小, 同时Demo网站[注: https://unit3d.site/]已经具有不错的用户体验, 因此笔者最终选择使用UNIT3D-Community-Edition进行二次开发。














